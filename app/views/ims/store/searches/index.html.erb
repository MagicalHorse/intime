<% if nil %>
<%= form_tag ims_store_searches_path, method: "GET", id: "search" do %>
  <%= text_field_tag "keywords", params[:keywords], placeholder: "搜索商品名称、品牌、货号等" %>
  <%= submit_tag "搜索" %>
<% end %>

<% if params[:keywords].blank? %>

<%= link_to "100元以内", "javascript:void(0);", class: "keywords", value: "100元以内" %>
<%= link_to "100~200元", "javascript:void(0);", class: "keywords", value: "100~200元" %>
<%= link_to "200元~300元", "javascript:void(0);", class: "keywords", value: "200元~300元" %>

<% else %>

  <% 3.times.each do %>
    <%= image_tag "/images/1.jpg" %>
  <% end %>

<% end %>
<% end %>



<div class="module module-searchinput">
    <div class="row-fluid">
        <div class="span12">
            <%= form_tag ims_store_searches_path, method: "GET", id: "search", class: "form-inline" do %>
              <%= text_field_tag "keywords", params[:keywords], placeholder: "搜索宝贝", class: "input-small bg-img" %>
              <%= hidden_field_tag "type" %>
              <%= hidden_field_tag "from" %>
              <%= hidden_field_tag "to" %>
              <%= hidden_field_tag "brand_id" %>
              <button class="btn" type="submit">搜 索</button>
            <% end %>
        </div>
    </div>
</div>

<% if params[:keywords].blank? && params[:type].blank? %>
<div class="module-tab">
  <div class="tabbable"> <!-- Only required for left/right tabs -->
      <ul class="nav nav-tabs">
          <li class="active"><a data-toggle="tab" href="#tab1">价格</a></li>
          <li class=""><a data-toggle="tab" href="#tab2">折扣</a></li>
          <li class=""><a data-toggle="tab" href="#tab3">品牌</a></li>
      </ul>
      <div class="tab-content">
          <div id="tab1" class="tab-pane active">
              <div class="search-condition">
                <% Ims::Product::Price.each do |price| %>
                  <%= link_to price[:name], "javascript:void(0);", type: price[:type], from: price[:from], to: price[:to] %>
                <% end %>
              </div>
          </div>
          <div id="tab2" class="tab-pane">
              <div class="search-condition">
                <% Ims::Product::Discount.each do |discount| %>
                  <%= link_to discount[:name], "javascript:void(0);", type: discount[:type], from: discount[:from], to: discount[:to] %>
                <% end %>
              </div>
          </div>
          <div id="tab3" class="tab-pane">
              <div class="search-condition">
                <% @brands.each do |brand| %>
                  <%= link_to brand[:name], "javascript:void(0);", brand_id: brand["id"] %>
                <% end %>
              </div>
          </div>

      </div>
  </div>
</div>

<% else %>

  <% @products.each do |products| %>
    <div class="module module-search-ele">
      <div class="module-title">
          <div class="row-fluid">
              <div class="span12"><h3><%= products.first["create_date"].to_date.to_s %></h3></div>
          </div>
      </div>
      <div class="search-result-content">
        <% products.in_groups_of(3).each do |objs| %>
          <div class="row-fluid">
            <% objs.compact.each do |obj| %>
              <div class="span4">
                  <div class="goods-box">
                      <div class="imgs"><img src="/images/ims/no-image.jpg"><div class="goods-price">￥<%= obj["price"] %></div></div>
                      <div class="goods-text">
                          <a href="#"><%= obj["desc"] %></a>
                          <button class="btn btn-danger btn-mini btn-block">选择搭配</button>
                      </div>
                  </div>
              </div>
            <% end %>
          </div>
        <% end %>

      </div>
  </div>
  <% end %>

<% end %>



<%= content_for :javascripts do -%>
<script type="text/javascript">
  $(function(){

    // $("#search").validate({
    //   rules: {
    //     "keywords": {
    //       required: true,
    //     }
    //   },
    //   errorPlacement:function(error, element){
    //     element.after(error)
    //   }
    // })

    $(".search-condition a").on("click", function(){
      this_ele = $(this)
      type = this_ele.attr("type")
      from = this_ele.attr("from")
      to = this_ele.attr("to")
      brand_id = this_ele.attr("brand_id")
      $("#type").attr("value", type)
      $("#from").attr("value", from)
      $("#to").attr("value", to)
      $("#brand_id").attr("value", brand_id)
      $("#search").submit()

    })

    $(".keywords").on("click", function(){
      keywords = $(this).attr("value")
      $("#keywords").val(keywords)
      $("#search").submit()
    })
  })
</script>
<% end %>