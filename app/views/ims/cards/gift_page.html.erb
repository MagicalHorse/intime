<% if flash[:page_type] == "give_show_page" %>

<div class="module module-white">
  <div class="module-card module-card-posi">
    <h1 class="text-center">银泰礼品卡<br>送亲人，送好友，您的最佳选择</h1>
    <img src="<%=Settings.fileserver_host%>/images/ims/card-self.png">
    <p class="txt4 text-center posi-txt">银泰礼品卡是银泰百货（集团）发行的银泰电子消费卡，持卡人可在全国所有的银泰百货消费。此卡可作为个人、机关、企事业单位礼品或福利卡。送亲人、送好友，您的最佳选择！</p>
  </div>
</div>  
<div class="bottom-button">
  <div class="form-defined">
    <div class="controls-defined defined-large">
      <div class="col-12"><a class="btn btn-danger btn-large btn-block" id="share_to_user_model">分享给好友</a></div>
    </div>
  </div>
</div>

<%= content_for :javascripts do %>
<script>
  $(function(){
    $("#shareToUserModel").modal();
  });

  if (typeof WxEnv == 'undefined') {
    WxEnv = {};
  }
  WxEnv.shareUrl = "<%= request.url %>";
  WxEnv.shareImgUrl = '<%= image_url "#{Settings.fileserver_host}/images/ims/card-self.png" %>';
  WxEnv.shareName = "<%= @card[:sender] %>给您送的银泰礼品卡";
  WxEnv.shareDes = "<%= @card[:comment] %>";
</script>
<% end %>

<% elsif @card[:status].to_i != 0 %>

<!--  如果已经处理了  -->
<div class="module module-white">
  <div class="module-card">
    <% if @card[:status].to_i == 3 %>
    <!--  如果已经转赠  -->
    <h1 class="text-center">您已将好友赠送的银泰礼品卡转赠给您的其他好友！</h1>
    <% elsif @card[:status].to_i == 1 %>
    <!--  如果已经收取  -->
    <h1 class="text-center">您已经接收好友赠送的银泰礼品卡！</h1>
    <% elsif @card[:status].to_i == 2 %>
    <!--  如果已经拒绝  -->
    <h1 class="text-center">您已拒绝好友赠送的银泰礼品卡！</h1>
    <% end %>
    <p class="txt1 text-center txt-money">礼品卡金额：<%= @card[:amount] %>元</p>
    <img src="<%=Settings.fileserver_host%>/images/ims/card-self.png">
  </div>
</div>  
<div class="bottom-button">
  <div class="form-defined">
    <div class="controls-defined defined-large">
      <div class="col-6">
        <a href="<%= mine_ims_accounts_path %>" class="btn btn-danger btn-large btn-block">进入首页</a>
      </div>
      <div class="col-6">
        <a href="<%= "#{ims_card_orders_pay_path}?showwxpaytitle=1" %>" class="btn btn-grey btn-large btn-block">我要购卡 </a>
      </div>
    </div>
  </div>
</div>

<% else %>

<div class="module module-white">
  <div class="module-card">
    <h1 class="text-center"><%= @card[:sender] %>给你送来一张银泰礼品卡</h1>
    <p class="txt1 text-center txt-money">礼品卡金额：<%= @card[:amount] %>元</p>
    <p class="txt3 card-text">
      好友留言：<%= @card[:comment] %>
    </p>
    <img src="<%=Settings.fileserver_host%>/images/ims/card-self.png">
  </div>
</div>  
<div class="bottom-button">
  <div class="form-defined">
    <div class="controls-defined defined-large">
      <div class="col-6"><button class="btn btn-danger btn-large btn-block" id="button_accept">接受礼品卡</button></div>
      <div class="col-6"><button class="btn btn-grey btn-large btn-block" id="button_give">转赠好友</button></div>
    </div>
  </div>
</div>

<%= content_for :javascripts do %>
<script>
  $(function(){

    $("#button_give").click(function(){
      window.location.href = "<%= give_page_ims_cards_path(charge_no: @charge_no, trans_id: @trans_id) %>";
    })

    $("#button_refuse").click(function(){
      var r = confirm("您确定要拒收吗？");
      if (r == true){
        window.location.href = "<%= refuse_ims_cards_path(charge_no: @charge_no, trans_id: @trans_id) %>";
      }
    })

    $("#button_accept").click(function(){
      window.location.href = "<%= recharge_ims_cards_path(charge_no: @charge_no, trans_id: @trans_id, charge_type: 'giftcard') %>";
    })

  });
</script>
<% end %>

<% end %>